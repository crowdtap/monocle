general:
  branches:
    ignore:
      - production
machine:
  timezone:
    America/New_York
dependencies:
  pre:
    - if ! berks --version; then
        if ! [ -f chefdk_0.3.2-1_amd64.deb ]; then
          wget http://opscode-omnibus-packages.s3.amazonaws.com/ubuntu/12.04/x86_64/chefdk_0.3.2-1_amd64.deb;
        fi;
        sudo dpkg -i chefdk_0.3.2-1_amd64.deb;
      fi
    - berks vendor -b chef/ci/Berksfile cookbooks
    - sudo chef-client -z -j chef/ci/dna.json
  cache_directories:
    - ./chefdk_0.3.2-1_amd64.deb
deployment:
  production:
    branch: master
    commands:
      - curl -XPOST https://deploy:20dca2067c57c415fd797184715b1b@deployer.crowdtap.us/deploys/$CIRCLE_PROJECT_REPONAME/production/$CIRCLE_SHA1
